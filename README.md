# Visulate Ora2PG
A Docker container and single page web application for Ora2Pg

## Overview

[Ora2Pg](https://github.com/darold/ora2pg) is an open source Perl script used to migrate an Oracle database to a PostgreSQL compatible schema. It connects an Oracle database, scans it to extract its structure or data, then generates SQL scripts for loading into a PostgreSQL database. It is a popular tool with users who are converting Oracle databases to PostgreSQL as part of a GCP or Azure migration (AWS has its own proprietary conversion tool).

Ora2Pg is a CLI application. It is a powerful tool in the hands of an experienced user but has usability issues for the first time user. The installation procedure is cumbersome with a number of prerequisite dependencies that must be installed manually. Once installed, the initial user experience is intimidating. Most of the functionality is controlled via a configuration file. This file is over 1100 lines long with many configuration parameters. It is not immediately apparent which parameters require user input.

This project aims to address some of the usability issues. It creates a Docker image to simplify the installation and adds a single page web application UI to control the configuration and execution of Ora2Pg.

The UI provides an HTML form to edit configuration parameters. This form allows the user to toggle between basic and advanced settings.
![Alt text](docs/images/visulate-ora2pg-config.png?raw=true "Visulate Ora2Pg configuration")

Once the configuration parameters have been set the user can run Ora2Pg via the UI and view its output.
![Alt text](docs/images/visulate-ora2pg-run.png?raw=true "Visulate Ora2Pg run results")

Output files are written to a Docker volume which can be bound to the host filesystem. There's also a UI to download output files.

## Quickstart

Build the docker image or pull the latest version from [Docker Hub](https://hub.docker.com/repository/docker/visulate/visulate-ora2pg).

Create a directory on your local host to hold the output from Ora2Pg:

```
mkdir ora2pg-projects
```

Run Visulate-Ora2Pg with a port and volume binding - example:

```
docker run -d -p 3000:3000 -v "$(pwd)/ora2pg-projects":/project visulate/visulate-ora2pg:1.0.0
```

Open your browser at http://localhost:3000 and follow the onscreen instructions

## Technical Description

The Dockerfile is in the project root. You can build it using:

```
docker build -t visulate-ora2pg:latest .
```

This builds an image that includes Ora2Pg and the UI.

The UI is implemented using a combination of Node/Express API and a Vue UI. The API handles interaction with the Ora2Pg CLI. The Vue UI handles presentation to the user. The UI and API communicate using a JSON representation of the ora2pg.conf file. The JSON document stores the ora2pg.conf data and metadata in a structured format suitable for use in the UI. For example, it records valid values for a parameter in an array where the  ora2pg.conf file documents these using comments. A handlebars template is used to convert the JSON document to a ora2pg.conf file at runtime.

The Vue UI is served from Express as static files. The entry point for this is the `express/ui/index.html` file. It initiates a Vue 3 application using components defined in the `express/ui/js/components` directory. The Vue UI makes REST API calls to the API. These are handled by the `express/api/ora2pg.js` router.

The REST API is organized around projects. Each project is a filesystem directory with an ora2pg-conf.json file and any files that have been generated by running Ora2Pg. The UI creates a default project on initial startup and can be used to add or remove projects as required. A menu in the UI allows users to navigate between projects.

When the user selects a project the UI gets the corresponding ora2pg-conf.json file from the API and displays its data in a form. This form can be used to edit its values and save or run the result.

Submitting a run from the UI initiates a [server sent event stream](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events). The UI issues an API call which performs the following actions:

1. Saves the ora2pg-conf.json file
2. Translates the ora2pg-conf.json into a temporary ora2pg.conf file
3. Initiates a "Content-Type": "text/event-stream"
4. Calls ora2pg using the temporary ora2pg.conf file
5. Pipes stdout and stderr from the ora2pg process to the event-stream
7. Writes ora2pg output files to the project directory
8. Waits for ora2pg to complete
9. Deletes the temporary ora2pg.conf file
10. Closes the event-stream

Project directories are created as subdirectories in the /project volume of the docker container. Ora2Pg output files can be accessed directly from the host computer if this volume was bound during `docker run`. They can also be downloaded from the 'Project Review' screen in the UI. This lists project files. It also provides an option to delete the project.